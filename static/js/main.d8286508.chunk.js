(this["webpackJsonpcogi-application"]=this["webpackJsonpcogi-application"]||[]).push([[4],{38:function(e,t,n){},39:function(e,t,n){},40:function(e,t,n){},47:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},58:function(e,t,n){},59:function(e,t,n){var c={"./README.md":[67,9,8],"./black-templars-boxes":[31,3,1],"./black-templars-boxes.json":[31,3,1],"./package":[30,3,0],"./package.json":[30,3,0],"./space-marines-boxes":[32,3,2],"./space-marines-boxes.json":[32,3,2],"./ultramarines-boxes":[33,3,3],"./ultramarines-boxes.json":[33,3,3]};function r(e){if(!n.o(c,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=c[e],r=t[0];return n.e(t[2]).then((function(){return n.t(r,t[1])}))}r.keys=function(){return Object.keys(c)},r.id=59,e.exports=r},60:function(e,t,n){},61:function(e,t,n){},62:function(e,t,n){},63:function(e,t,n){},64:function(e,t,n){},65:function(e,t,n){},66:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),o=n(15),a=n.n(o),i=(n(38),n(39),n(40),n(4)),u=n(16),s=new Map;function l(e,t){var n=s.get(e)||new Set;return n.add(t),s.set(e,n),function(){n.delete(t)}}function d(e){return new Promise((function(t,n){e.addEventListener("success",(function(){t(e)})),e.addEventListener("error",(function(){n()}))}))}function j(e){return new Promise((function(t,n){var c=e.createObjectStore("models",{keyPath:"id"});c.createIndex("id","id",{unique:!0}),c.transaction.oncomplete=function(){return t()},c.transaction.onerror=function(){return n()}}))}function b(e){return new Promise((function(t,n){var c=e.createObjectStore("images");c.createIndex("id","id",{unique:!0}),c.transaction.oncomplete=t,c.transaction.onerror=n}))}function f(e,t){return new Promise((function(e,t){var n=indexedDB.open("collection",2);n.onsuccess=function(t){e(t.target.result)},n.onerror=function(){t()},n.onupgradeneeded=function(e){console.log("onupgrade");var t=e.target.result;"models"in t.objectStoreNames||j(t),"images"in t.objectStoreNames||b(t);var n=t.objectStoreNames;n.contains("models")||j(t),n.contains("images")||b(t)}})).then((function(n){var c=n.transaction([e],t),r=c.objectStore(e);return"readonly"===t||c.addEventListener("complete",(function(){!function(e){var t=s.get(e);if(t){var n,c=Object(u.a)(t);try{for(c.s();!(n=c.n()).done;)(0,n.value)()}catch(r){c.e(r)}finally{c.f()}}}(e)})),r}))}function m(){return f("models","readonly").then((function(e){return d(e.getAll()).then((function(e){return e.result}))}))}var O=n(3),h=n(9),x=n(11),v=Object(x.b)({name:"selectedModels",initialState:[],reducers:{clear:function(e){return[]},add:function(e,t){var n=(Array.isArray(t.payload)?t.payload:[t.payload]).filter((function(t){return-1===e.findIndex((function(e){return t.id===e.id}))}));return[].concat(Object(h.a)(e),Object(h.a)(n))},remove:function(e,t){return e.filter((function(e){return e.id!==t.payload.id}))}}}),p=v.actions,g=(p.clear,p.add,p.remove,function(e){return e.selectedModels}),y=v.reducer;function k(e){var t=Object(c.useState)(void 0),n=Object(i.a)(t,2),r=n[0],o=n[1],a=e.id;return Object(c.useEffect)((function(){var e=!0;return void 0===r&&function(e){return f("images","readonly").then((function(t){return d(t.get(e)).then((function(e){return e.result?window.URL.createObjectURL(e.result):null}))}))}(a).then((function(t){e&&o(t)})),function(){e=!1}}),[r,o,a]),{image:r}}var w=n(8),N=n(12),S=(n(47),n(0));function C(e){return Object(S.jsx)("span",{className:"badge",style:{backgroundColor:e.color},children:e.text})}n(49);function M(e){return Object(S.jsx)("div",{className:"badges",children:e.badges.map((function(e,t){return Object(S.jsx)(C,Object(N.a)({},e),t)}))})}n(50);function E(e){var t=e.selectable||!1;var n=["card"];return e.image&&n.push("card-withside"),Object(S.jsxs)("div",{className:n.join(" "),children:[e.image&&Object(S.jsx)("img",{className:"card-image",src:e.image,alt:""}),Object(S.jsxs)("div",{className:"card-title",children:[t&&Object(S.jsx)("input",{type:"checkbox",onChange:function(t){var n=!0===t.target.checked;e.onSelectChange&&e.onSelectChange(n)},checked:e.selected||!1}),e.url&&Object(S.jsx)(w.b,{to:e.url,children:e.title}),!e.url&&Object(S.jsx)("span",{children:e.title})]}),Object(S.jsxs)("div",{children:[e.badges&&Object(S.jsx)(M,{badges:e.badges}),e.children]})]})}var P=n.p+"static/media/Item-noimage.d5a93a57.svg";function A(e){var t=Object(O.c)(g),n=Object(O.b)(),c=k(e.model).image;var r=[{text:e.model.state,color:"var(--model-state-".concat(e.model.state,")")}];return Object(S.jsx)(E,{title:e.model.name,url:"/model/".concat(e.model.id),selectable:!0,onSelectChange:function(t){n(!0===t?{type:"selectedModels/add",payload:e.model}:{type:"selectedModels/remove",payload:e.model})},selected:!!t.find((function(t){return t.id===e.model.id})),image:c||P,badges:r})}function D(){var e=function(){var e=Object(c.useState)(),t=Object(i.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){var e=!0;return void 0===n&&m().then((function(t){e&&r(t.sort((function(e,t){return e.name.localeCompare(t.name)})))})),function(){e=!1}}),[n,r]),Object(c.useEffect)((function(){var e=l("models",(function(){return r(void 0)}));return function(){return e()}}),[]),{collection:n||[]}}(),t=e.collection;return Object(S.jsx)("div",{className:"cards cards-grid",children:t.map((function(e){return Object(S.jsx)(A,{model:e},e.id)}))})}function F(e){return f("models","readwrite").then((function(t){return d(t.delete("object"===typeof e?e.id:e)).then((function(){}))}))}function B(){var e=Object(O.c)(g),t=Object(O.b)();return Object(S.jsx)("div",{className:"buttonsrow",children:Object(S.jsx)("button",{disabled:0===e.length,onClick:function(){e.forEach((function(e){return F(e)})),t({type:"selectedModels/clear"})},children:"Remove"})})}function L(){var e=Object(O.b)();return Object(S.jsxs)("div",{className:"buttonsrow",children:[Object(S.jsx)("button",{onClick:function(){e({type:"selectedModels/clear"})},children:"Unselect"}),Object(S.jsx)("button",{onClick:function(){m().then((function(t){e({type:"selectedModels/add",payload:t})}))},children:"Select all"})]})}var I=n(6);function U(e){return f("models","readwrite").then((function(t){return d(t.put(e)).then((function(){return e}))}))}function R(e){return Promise.all(e.map(U)).then((function(){return e}))}function q(){var e=Object(O.c)(g);function t(t){R(e.map((function(e){return Object.assign({},e,{state:t})})))}return Object(S.jsxs)("div",{className:"buttonsrow buttonsrow-narrow",children:[Object(S.jsx)("button",{className:"button-unknown",onClick:function(){return t(I.ModelState.Unknown)},children:"Unknown"}),Object(S.jsx)("button",{className:"button-packaged",onClick:function(){return t(I.ModelState.Packaged)},children:"Packaged"}),Object(S.jsx)("button",{className:"button-assembled",onClick:function(){return t(I.ModelState.Assembled)},children:"Assembled"}),Object(S.jsx)("button",{className:"button-primed",onClick:function(){return t(I.ModelState.Primed)},children:"Primed"}),Object(S.jsx)("button",{className:"button-painted",onClick:function(){return t(I.ModelState.Painted)},children:"Painted"}),Object(S.jsx)("button",{className:"button-done",onClick:function(){return t(I.ModelState.Done)},children:"Done"}),Object(S.jsx)("button",{className:"button-broken",onClick:function(){return t(I.ModelState.Broken)},children:"Broken"})]})}n(58);function T(){return Object(S.jsxs)("div",{className:"collection-toolbar",children:[Object(S.jsx)(L,{}),Object(S.jsx)(q,{}),Object(S.jsx)(B,{})]})}function V(){return Object(S.jsxs)("div",{className:"maincontainer",children:[Object(S.jsx)(T,{}),Object(S.jsx)(D,{})]})}var Q=n(10),J=Object(x.b)({name:"addModels",initialState:[],reducers:{clear:function(e){return[]},add:function(e,t){var n=Array.isArray(t.payload)?t.payload:[t.payload];return[].concat(Object(h.a)(e),Object(h.a)(n))},insert:function(e,t){var n=t.payload,c=Object(h.a)(e);return c[n.index]=n.model,c.map((function(e){return e||{}}))}}}),_=J.actions,z=(_.clear,_.add,_.insert),G=function(e){return e.addModels},H=J.reducer,K=Object(x.b)({name:"catalogueQuery",initialState:{},reducers:{set:function(e,t){return t.payload}}}),W=K.actions.set,X=function(e){return e.catalogueQuery},Y=K.reducer,Z=Object(x.a)({reducer:Object(Q.b)({selectedModels:y,addModels:H,catalogueQuery:Y})}),$=function(){var e=n.e(0).then(n.t.bind(null,30,3)).then((function(e){var t=e.default.datafiles,c=Promise.all(t.map((function(e){return n(59)("./".concat(e)).then((function(e){return console.log(e.default),e.default})).then((function(e){return e.map(I.buildBox)}))})));return c.then((function(e){var t=[];return t.concat.apply(t,Object(h.a)(e))}))}));return function(){return e}}();function ee(){return $()}function te(e){var t,n=e.box,c=[{text:n.availability,color:"var(--badge-black)"},{text:"".concat(n.models.length," models"),color:"var(--badge-black)"}];return c=(t=c).concat.apply(t,Object(h.a)(e.box.tags.map((function(e){return{text:e,color:"var(--badge-red)"}})))),Object(S.jsx)(E,{title:n.name,badges:c,children:Object(S.jsx)(w.b,{to:"/new-model/box/".concat(e.box.id),children:Object(S.jsx)("button",{children:"To collection"})})})}function ne(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Object(c.useState)(),n=Object(i.a)(t,2),r=n[0],o=n[1];return Object(c.useEffect)((function(){var t=!0;return ee().then((function(n){if(t)return e?void o(n.filter((function(t){return Object(I.matchBox)(e,t)}))):o(n)})),function(){t=!1}}),[o,e]),{catalogue:r||[]}}(Object(O.c)(X).keyword),t=e.catalogue;return Object(S.jsx)("div",{className:"cards cards-grid",children:t.map((function(e){return Object(S.jsx)(te,{box:e},e.id)}))})}var ce=function(){var e=Object(O.b)(),t=Object(O.c)(X);return Object(S.jsx)("div",{children:Object(S.jsx)("input",{type:"text",defaultValue:t.keyword,onChange:function(t){var n=t.target,c={};n.value&&(c.keyword=n.value),e(W(c))},placeholder:"Search query..."})})};function re(){return Object(S.jsx)("div",{children:Object(S.jsx)(ce,{})})}function oe(){return Object(S.jsxs)("main",{className:"maincontainer",children:[Object(S.jsx)(re,{}),Object(S.jsx)(ne,{})]})}var ae=n(2),ie=n(29),ue=(n(60),["children","to"]);function se(e){var t=e.children,n=e.to,c=Object(ie.a)(e,ue),r=Object(ae.j)(n),o=["frame-header-link"];return Object(ae.g)({path:r.pathname,end:!0})&&o.push("active"),Object(S.jsx)(w.b,Object(N.a)(Object(N.a)({className:o.join(" "),to:n},c),{},{children:t}))}n(61);function le(){return Object(S.jsxs)("header",{className:"frame-header maincontainer",children:[Object(S.jsxs)("nav",{children:[Object(S.jsx)(se,{to:"/collection",children:"Collection"}),Object(S.jsx)(se,{to:"/catalogue",children:"Catalogue"})]}),Object(S.jsx)("h1",{children:"Cogishpere"})]})}n(62);function de(){var e=function(){var e=Object(c.useState)(void 0),t=Object(i.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){return navigator.storage.persisted().then((function(e){return e?Promise.resolve(e):navigator.storage.persist()})).then((function(e){})),function(){}}),[n,r]),{persisted:!!n,request:function(){navigator.storage.persisted().then((function(e){return e?Promise.resolve(e):navigator.storage.persist()})).then((function(e){return r(e)}))}}}(),t=e.persisted,n=e.request;return Object(S.jsx)(S.Fragment,{children:!t&&Object(S.jsxs)("div",{className:"frame-snacknotification",children:["The application is not granted persisten storage. All changes will be wiped out when closed.",Object(S.jsx)("button",{onClick:n,children:"Allow persistent storage"})]})})}function je(){return Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(le,{}),Object(S.jsx)(ae.a,{}),Object(S.jsx)(de,{})]})}n(63);function be(e){return Object(S.jsxs)("div",{className:"field",children:[Object(S.jsx)("label",{className:"field-label",children:e.label}),Object(S.jsx)("div",{className:"field-content",children:e.children})]})}n(64);function fe(e){return Object(S.jsx)("input",Object(N.a)({className:"headerinput"},e))}function me(e){var t=Object(c.useState)("object"===typeof e?e:void 0),n=Object(i.a)(t,2),r=n[0],o=n[1],a="object"===typeof e?e.id:e;return Object(c.useEffect)((function(){var e=!0;return void 0===r&&function(e){return f("models","readonly").then((function(t){return d(t.get(e)).then((function(e){return e.result}))}))}(a).then((function(t){e&&o(t)})),function(){e=!1,console.log("unmount model effect",a)}}),[r,o,a]),Object(c.useEffect)((function(){var e=l("models",(function(){o(void 0)}));return function(){return e()}}),[]),{model:r||null,removeModel:function(){F(a)},setModel:function(e){if(e.id!==a)throw Error("unexpected model");U(e)}}}function Oe(e){var t=me(e.model).removeModel;return Object(S.jsxs)("div",{children:[Object(S.jsx)("button",{type:"button",onClick:function(){return t()},children:"Remove"}),Object(S.jsx)("button",{type:"submit",children:"Store"})]})}function he(){var e=me(Object(ae.i)().model),t=e.model,n=e.setModel,r=Object(c.useRef)(null),o=Object(c.useCallback)((function(e){if(e.preventDefault(),r.current&&t){var c=new FormData(r.current),o=Object.assign({},t,{name:c.get("name"),notes:c.get("notes")});n(o);var a=c.get("image");a.size>0&&function(e,t){f("images","readwrite").then((function(n){return d(n.put(e,t)).then((function(e){return console.log(e)}))}))}(a,t.id)}}),[t,n,r]);return Object(S.jsx)("form",{ref:r,className:"maincontainer",onSubmit:o,children:t&&Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(Oe,{model:t}),Object(S.jsx)(be,{label:"Model name",children:Object(S.jsx)(fe,{name:"name",defaultValue:t.name})}),Object(S.jsx)(be,{label:"Image",children:Object(S.jsx)("input",{type:"file",name:"image",accept:"image/png, image/jpeg"})}),Object(S.jsx)(be,{label:"Notes",children:Object(S.jsx)("textarea",{name:"notes",defaultValue:t.notes})})]})})}n(65);function xe(e){var t=e.model.possibilities,n=Object(O.c)(G),r=Object(O.b)(),o=Object(c.useCallback)((function(t){r(z({index:e.index,model:e.model.possibilities[t]}))}),[r,e]);return Object(c.useEffect)((function(){o(0)}),[]),Object(S.jsx)("div",{className:"addmodel-modeldefinition",children:t.map((function(t,c){var r;return Object(S.jsxs)("div",{children:[Object(S.jsx)("input",{type:"radio",checked:(null===(r=n[e.index])||void 0===r?void 0:r.name)===t.name,onChange:function(){return o(c)}}),Object(S.jsx)("input",{type:"text",defaultValue:t.name})]},c)}))})}function ve(e){var t=Object(c.useState)(),n=Object(i.a)(t,2),r=n[0],o=n[1];return Object(c.useEffect)((function(){var t=!0;return function(e){return ee().then((function(t){var n=t.find((function(t){return t.id===e}));if(!n)throw Error("Box not found");return n}))}(e).then((function(e){t&&o(e)})),function(){t=!1}}),[r,o,e]),{box:r}}function pe(){var e=ve(Object(ae.i)().id||"").box,t=Object(O.c)(G),n=Object(O.b)(),r=Object(ae.h)();return Object(c.useEffect)((function(){n({type:"addModels/clear"})}),[n]),Object(S.jsxs)("div",{className:"maincontainer",children:[Object(S.jsx)("h1",{children:"Add models"}),Object(S.jsxs)("form",{onSubmit:function(e){e.preventDefault(),R(t.map(I.buildModel)),r("/collection")},children:[e&&e.models.map((function(e,t){return Object(S.jsx)(xe,{model:e,index:t},t)})),Object(S.jsx)("button",{children:"Add"})]})]})}var ge=function(){return Object(S.jsx)(O.a,{store:Z,children:Object(S.jsx)(w.a,{children:Object(S.jsx)(ae.d,{children:Object(S.jsxs)(ae.b,{path:"*",element:Object(S.jsx)(je,{}),children:[Object(S.jsx)(ae.b,{path:"catalogue",element:Object(S.jsx)(oe,{})}),Object(S.jsx)(ae.b,{path:"collection",element:Object(S.jsx)(V,{})}),Object(S.jsx)(ae.b,{path:"model/:model",element:Object(S.jsx)(he,{})}),Object(S.jsx)(ae.b,{path:"new-model/:type/:id",element:Object(S.jsx)(pe,{})})]})})})})},ye=function(e){e&&e instanceof Function&&n.e(7).then(n.bind(null,68)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,o=t.getLCP,a=t.getTTFB;n(e),c(e),r(e),o(e),a(e)}))};a.a.render(Object(S.jsx)(r.a.StrictMode,{children:Object(S.jsx)(ge,{})}),document.getElementById("root")),ye()}},[[66,5,6]]]);
//# sourceMappingURL=main.d8286508.chunk.js.map