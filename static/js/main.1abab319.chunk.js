(this["webpackJsonpcogi-application"]=this["webpackJsonpcogi-application"]||[]).push([[0],{31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},40:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){},51:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){},54:function(e,t,n){},55:function(e,t,n){},56:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),o=n(15),i=n.n(o),a=(n(31),n(32),n(33),n(3)),u=n(16),l=new Map;function s(e,t){var n=l.get(e)||new Set;return n.add(t),l.set(e,n),function(){n.delete(t)}}function d(e){return new Promise((function(t,n){e.addEventListener("success",(function(){t(e)})),e.addEventListener("error",(function(){n()}))}))}function j(e){return new Promise((function(t,n){var c=e.createObjectStore("models",{keyPath:"id"});c.createIndex("id","id",{unique:!0}),c.transaction.oncomplete=function(){return t()},c.transaction.onerror=function(){return n()}}))}function b(e){return new Promise((function(t,n){var c=e.createObjectStore("images");c.createIndex("id","id",{unique:!0}),c.transaction.oncomplete=t,c.transaction.onerror=n}))}function f(e,t){return new Promise((function(e,t){var n=indexedDB.open("collection",2);n.onsuccess=function(t){e(t.target.result)},n.onerror=function(){t()},n.onupgradeneeded=function(e){console.log("onupgrade");var t=e.target.result;"models"in t.objectStoreNames||j(t),"images"in t.objectStoreNames||b(t);var n=t.objectStoreNames;n.contains("models")||j(t),n.contains("images")||b(t)}})).then((function(n){var c=n.transaction([e],t),r=c.objectStore(e);return"readonly"===t||c.addEventListener("complete",(function(){!function(e){var t=l.get(e);if(t){var n,c=Object(u.a)(t);try{for(c.s();!(n=c.n()).done;)(0,n.value)()}catch(r){c.e(r)}finally{c.f()}}}(e)})),r}))}function m(){return f("models","readonly").then((function(e){return d(e.getAll()).then((function(e){return e.result}))}))}var O=n(4),h=n(11),x=n(13),v=Object(x.b)({name:"selectedModels",initialState:[],reducers:{clear:function(e){return[]},add:function(e,t){var n=(Array.isArray(t.payload)?t.payload:[t.payload]).filter((function(t){return-1===e.findIndex((function(e){return t.id===e.id}))}));return[].concat(Object(h.a)(e),Object(h.a)(n))},remove:function(e,t){return e.filter((function(e){return e.id!==t.payload.id}))}}}),p=v.actions,g=(p.clear,p.add,p.remove,function(e){return e.selectedModels}),y=v.reducer;function k(e){var t=Object(c.useState)(void 0),n=Object(a.a)(t,2),r=n[0],o=n[1],i=e.id;return Object(c.useEffect)((function(){var e=!0;return void 0===r&&function(e){return f("images","readonly").then((function(t){return d(t.get(e)).then((function(e){return e.result?window.URL.createObjectURL(e.result):null}))}))}(i).then((function(t){e&&o(t)})),function(){e=!1}}),[r,o,i]),{image:r}}var N=n(8),S=n(10),w=(n(40),n(0));function M(e){return Object(w.jsx)("span",{className:"badge",style:{backgroundColor:e.color},children:e.text})}n(42);function C(e){return Object(w.jsx)("div",{className:"badges",children:e.badges.map((function(e,t){return Object(w.jsx)(M,Object(S.a)({},e),t)}))})}n(43);function E(e){var t=e.selectable||!1;var n=["card"];return e.image&&n.push("card-withside"),Object(w.jsxs)("div",{className:n.join(" "),children:[e.image&&Object(w.jsx)("img",{className:"card-image",src:e.image,alt:""}),Object(w.jsxs)("div",{className:"card-title",children:[t&&Object(w.jsx)("input",{type:"checkbox",onChange:function(t){var n=!0===t.target.checked;e.onSelectChange&&e.onSelectChange(n)},checked:e.selected||!1}),e.url&&Object(w.jsx)(N.b,{to:e.url,children:e.title}),!e.url&&Object(w.jsx)("span",{children:e.title})]}),Object(w.jsxs)("div",{children:[e.badges&&Object(w.jsx)(C,{badges:e.badges}),e.children]})]})}var P=n.p+"static/media/Item-noimage.d5a93a57.svg";function A(e){var t=Object(O.c)(g),n=Object(O.b)(),c=k(e.model).image;var r=[{text:e.model.state,color:"var(--model-state-".concat(e.model.state,")")}];return Object(w.jsx)(E,{title:e.model.name,url:"/model/".concat(e.model.id),selectable:!0,onSelectChange:function(t){n(!0===t?{type:"selectedModels/add",payload:e.model}:{type:"selectedModels/remove",payload:e.model})},selected:!!t.find((function(t){return t.id===e.model.id})),image:c||P,badges:r})}function F(){var e=function(){var e=Object(c.useState)(null),t=Object(a.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){var e=!0;return null===n&&m().then((function(t){e&&r(t.sort((function(e,t){return e.name.localeCompare(t.name)})))})),function(){e=!1}}),[n,r]),Object(c.useEffect)((function(){var e=s("models",(function(){return r(null)}));return function(){return e()}}),[]),{collection:n||[]}}(),t=e.collection;return Object(w.jsx)("div",{className:"cards cards-grid",children:t.map((function(e){return Object(w.jsx)(A,{model:e},e.id)}))})}function B(e){return f("models","readwrite").then((function(t){return d(t.delete("object"===typeof e?e.id:e)).then((function(){}))}))}function D(){var e=Object(O.c)(g),t=Object(O.b)();return Object(w.jsx)("div",{className:"buttonsrow",children:Object(w.jsx)("button",{disabled:0===e.length,onClick:function(){e.forEach((function(e){return B(e)})),t({type:"selectedModels/clear"})},children:"Remove"})})}function I(){var e=Object(O.b)();return Object(w.jsxs)("div",{className:"buttonsrow",children:[Object(w.jsx)("button",{onClick:function(){e({type:"selectedModels/clear"})},children:"Unselect"}),Object(w.jsx)("button",{onClick:function(){m().then((function(t){e({type:"selectedModels/add",payload:t})}))},children:"Select all"})]})}var L=n(7);function R(e){return f("models","readwrite").then((function(t){return d(t.put(e)).then((function(){return e}))}))}function U(e){return Promise.all(e.map(R)).then((function(){return e}))}function T(){var e=Object(O.c)(g);function t(t){U(e.map((function(e){return Object.assign({},e,{state:t})})))}return Object(w.jsxs)("div",{className:"buttonsrow buttonsrow-narrow",children:[Object(w.jsx)("button",{className:"button-unknown",onClick:function(){return t(L.ModelState.Unknown)},children:"Unknown"}),Object(w.jsx)("button",{className:"button-packaged",onClick:function(){return t(L.ModelState.Packaged)},children:"Packaged"}),Object(w.jsx)("button",{className:"button-assembled",onClick:function(){return t(L.ModelState.Assembled)},children:"Assembled"}),Object(w.jsx)("button",{className:"button-primed",onClick:function(){return t(L.ModelState.Primed)},children:"Primed"}),Object(w.jsx)("button",{className:"button-painted",onClick:function(){return t(L.ModelState.Painted)},children:"Painted"}),Object(w.jsx)("button",{className:"button-done",onClick:function(){return t(L.ModelState.Done)},children:"Done"}),Object(w.jsx)("button",{className:"button-broken",onClick:function(){return t(L.ModelState.Broken)},children:"Broken"})]})}n(51);function V(){return Object(w.jsxs)("div",{className:"collection-toolbar",children:[Object(w.jsx)(I,{}),Object(w.jsx)(T,{}),Object(w.jsx)(D,{})]})}function q(){return Object(w.jsxs)("div",{className:"maincontainer",children:[Object(w.jsx)(V,{}),Object(w.jsx)(F,{})]})}var J=n(9),z=Object(x.b)({name:"addModels",initialState:[],reducers:{clear:function(e){return[]},add:function(e,t){var n=Array.isArray(t.payload)?t.payload:[t.payload];return[].concat(Object(h.a)(e),Object(h.a)(n))},insert:function(e,t){var n=t.payload,c=Object(h.a)(e);return c[n.index]=n.model,c.map((function(e){return e||{}}))}}}),G=z.actions,H=(G.clear,G.add,G.insert),K=function(e){return e.addModels},Q=z.reducer,W=Object(x.a)({reducer:Object(J.b)({selectedModels:y,addModels:Q})}),X=function(){var e=n.e(4).then(n.t.bind(null,59,3)).then((function(e){return e.default})).then((function(e){return e.map(L.buildBox)}));return function(){return e}}();function Y(){return X()}function Z(e){var t=e.box,n=[{text:t.availability,color:"black"},{text:"".concat(t.models.length," models"),color:"black"}];return Object(w.jsx)(E,{title:t.name,badges:n,children:Object(w.jsx)(N.b,{to:"/new-model/box/".concat(e.box.id),children:Object(w.jsx)("button",{children:"To collection"})})})}function $(){var e=Object(c.useState)([]),t=Object(a.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){Y().then(r)}),[]),Object(w.jsx)("div",{className:"cards cards-grid",children:n.map((function(e){return Object(w.jsx)(Z,{box:e},e.id)}))})}function _(){return Object(w.jsx)("main",{className:"maincontainer",children:Object(w.jsx)($,{})})}var ee=n(2),te=n(26),ne=(n(52),["children","to"]);function ce(e){var t=e.children,n=e.to,c=Object(te.a)(e,ne),r=Object(ee.j)(n),o=["frame-header-link"];return Object(ee.g)({path:r.pathname,end:!0})&&o.push("active"),Object(w.jsx)(N.b,Object(S.a)(Object(S.a)({className:o.join(" "),to:n},c),{},{children:t}))}n(53);function re(){return Object(w.jsxs)("header",{className:"frame-header maincontainer",children:[Object(w.jsxs)("nav",{children:[Object(w.jsx)(ce,{to:"/collection",children:"Collection"}),Object(w.jsx)(ce,{to:"/catalogue",children:"Catalogue"})]}),Object(w.jsx)("h1",{children:"Cogishpere"})]})}n(54);function oe(){var e=function(){var e=Object(c.useState)(void 0),t=Object(a.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){return navigator.storage.persisted().then((function(e){return e?Promise.resolve(e):navigator.storage.persist()})).then((function(e){})),function(){}}),[n,r]),{persisted:!!n}}(),t=e.persisted;return Object(w.jsx)(w.Fragment,{children:!t&&Object(w.jsx)("div",{className:"frame-snacknotification",children:"The application is not granted persisten storage. All changes will be wiped out when closed."})})}function ie(){return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(re,{}),Object(w.jsx)(ee.a,{}),Object(w.jsx)(oe,{})]})}n(55);function ae(e){return Object(w.jsxs)("div",{className:"field",children:[Object(w.jsx)("label",{className:"field-label",children:e.label}),Object(w.jsx)("div",{className:"field-content",children:e.children})]})}n(56);function ue(e){return Object(w.jsx)("input",Object(S.a)({className:"headerinput"},e))}function le(e){var t=Object(c.useState)("object"===typeof e?e:void 0),n=Object(a.a)(t,2),r=n[0],o=n[1],i="object"===typeof e?e.id:e;return Object(c.useEffect)((function(){var e=!0;return void 0===r&&function(e){return f("models","readonly").then((function(t){return d(t.get(e)).then((function(e){return e.result}))}))}(i).then((function(t){e&&o(t)})),function(){e=!1,console.log("unmount model effect",i)}}),[r,o,i]),Object(c.useEffect)((function(){var e=s("models",(function(){o(void 0)}));return function(){return e()}}),[]),{model:r||null,removeModel:function(){B(i)},setModel:function(e){if(e.id!==i)throw Error("unexpected model");R(e)}}}function se(e){var t=le(e.model).removeModel;return Object(w.jsxs)("div",{children:[Object(w.jsx)("button",{type:"button",onClick:function(){return t()},children:"Remove"}),Object(w.jsx)("button",{type:"submit",children:"Store"})]})}function de(){var e=le(Object(ee.i)().model),t=e.model,n=e.setModel,r=Object(c.useRef)(null),o=Object(c.useCallback)((function(e){if(e.preventDefault(),r.current&&t){var c=new FormData(r.current),o=Object.assign({},t,{name:c.get("name"),notes:c.get("notes")});n(o);var i=c.get("image");i.size>0&&function(e,t){f("images","readwrite").then((function(n){return d(n.put(e,t)).then((function(e){return console.log(e)}))}))}(i,t.id)}}),[t,n,r]);return Object(w.jsx)("form",{ref:r,className:"maincontainer",onSubmit:o,children:t&&Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(se,{model:t}),Object(w.jsx)(ae,{label:"Model name",children:Object(w.jsx)(ue,{name:"name",defaultValue:t.name})}),Object(w.jsx)(ae,{label:"Image",children:Object(w.jsx)("input",{type:"file",name:"image",accept:"image/png, image/jpeg"})}),Object(w.jsx)(ae,{label:"Notes",children:Object(w.jsx)("textarea",{name:"notes",defaultValue:t.notes})})]})})}n(57);function je(e){var t=e.model.possibilities,n=Object(O.c)(K),r=Object(O.b)(),o=Object(c.useCallback)((function(t){r(H({index:e.index,model:e.model.possibilities[t]}))}),[r,e]);return Object(c.useEffect)((function(){o(0)}),[]),Object(w.jsx)("div",{className:"addmodel-modeldefinition",children:t.map((function(t,c){var r;return Object(w.jsxs)("div",{children:[Object(w.jsx)("input",{type:"radio",checked:(null===(r=n[e.index])||void 0===r?void 0:r.name)===t.name,onChange:function(){return o(c)}}),Object(w.jsx)("input",{type:"text",defaultValue:t.name})]},c)}))})}function be(e){var t=Object(c.useState)(),n=Object(a.a)(t,2),r=n[0],o=n[1];return Object(c.useEffect)((function(){var t=!0;return function(e){return Y().then((function(t){var n=t.find((function(t){return t.id===e}));if(!n)throw Error("Box not found");return n}))}(e).then((function(e){t&&o(e)})),function(){t=!1}}),[r,o,e]),{box:r}}function fe(){var e=be(Object(ee.i)().id||"").box,t=Object(O.c)(K),n=Object(O.b)(),r=Object(ee.h)();return Object(c.useEffect)((function(){n({type:"addModels/clear"})}),[n]),Object(w.jsxs)("div",{className:"maincontainer",children:[Object(w.jsx)("h1",{children:"Add models"}),Object(w.jsxs)("form",{onSubmit:function(e){e.preventDefault(),U(t.map(L.buildModel)),r("/collection")},children:[e&&e.models.map((function(e,t){return Object(w.jsx)(je,{model:e,index:t},t)})),Object(w.jsx)("button",{children:"Add"})]})]})}var me=function(){return Object(w.jsx)(O.a,{store:W,children:Object(w.jsx)(N.a,{children:Object(w.jsx)(ee.d,{children:Object(w.jsxs)(ee.b,{path:"*",element:Object(w.jsx)(ie,{}),children:[Object(w.jsx)(ee.b,{path:"catalogue",element:Object(w.jsx)(_,{})}),Object(w.jsx)(ee.b,{path:"collection",element:Object(w.jsx)(q,{})}),Object(w.jsx)(ee.b,{path:"model/:model",element:Object(w.jsx)(de,{})}),Object(w.jsx)(ee.b,{path:"new-model/:type/:id",element:Object(w.jsx)(fe,{})})]})})})})},Oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,60)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),c(e),r(e),o(e),i(e)}))};i.a.render(Object(w.jsx)(r.a.StrictMode,{children:Object(w.jsx)(me,{})}),document.getElementById("root")),Oe()}},[[58,1,2]]]);
//# sourceMappingURL=main.1abab319.chunk.js.map